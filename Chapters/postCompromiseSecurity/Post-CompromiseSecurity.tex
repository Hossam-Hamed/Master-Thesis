\chapter{Post-Compromise Security} \label{ch:postcomp}
%Intro
Intro\\compromise window\\
\par
ratchet key exchange (RKE) URKE, SRKE, BRKE
\par
“a ratcheting
forward secrecy protocol that works in synchronous and asynchronous messaging environments” [55, 56].
Signal’s goals include end-to-end encryption as well as advanced security properties such as perfect forward secrecy and “future secrecy”
The Signal protocol can be roughly divided into three types of stages:
• The initial key exchange, or X3DH (extended triple Diffie-Hellman) protocol [64], which combines
long-term, medium-term and ephemeral Diffie-Hellman keys to produce a shared secret “root” value.
• An asymmetric ratchet stage [63], where users alternate in sending new ephemeral Diffie-Hellman keys in a ping-pong fashion with previously generated root keys to generate forward-secret chaining keys.
• A symmetric ratchet stage [63], where users take no additional entropy but instead use key derivation
functions to ratchet forward chaining keys to create symmetric encryption keys.

\input{Chapters/postCompromiseSecurity/x3dh/X3DH.tex}
\input{Chapters/postCompromiseSecurity/doubleRatchet/DoubleRatchet.tex}

\section{Formal Verification of Signal Protocol}
For completeness, we mention below former work related aimed at formally analyzing the Signal protocol without diving into details.
\par
Cohn-Gordon et al. \cite{cohn2020formal} were the first to address Signal's security in a formal manner. The verification methodology is highly comprehensive and sophisticated, and it is designed particularly for the Signal protocol \cite{alwen_coretti_dodis_2020}. A completely adversarially controlled network is used to evaluate the protocol. Through the definition of a security model, the research covers Signal's \gls{x3dh} and Double Ratchet protocols as a multi-stage authenticated key exchange protocol. The model depicts the ratcheting key update structure as a multi-stage model, where instead of just a sequence, it is a tree-like structure of stages that reflect the chains in Signal. The model enables different parties to run numerous, simultaneous sessions, each with its own set of stages. Secrecy and authentication of message keys in the computational model, under a rich compromise scenario, are the high-level features targeted to be verified by hand. Nevertheless, forward and future secrecy are implied goals, as derived session keys should be kept secret in a range of compromise circumstances. For instance, if a long-term secret is compromised but a medium or ephemeral secret is not, or if a state is compromised and a secure asymmetric stage happens afterwards. Since Signal does not cleanly separate key exchange from subsequent data messages, the model had to reorder some procedures to achieve this separation. In addition and contrary to Signal, the model does not re-use \gls{dh} keys for signatures. Finally, the research shows that Signal's cryptographic core delivers the desirable security attributes specified in the security model, based on normal cryptographic assumptions. Reassuringly, its design is free of any severe defects. The model, on the other hand, does not address Signal's instantaneous decryption feature, which is a distinctive feature that privileges it to other protocols that lack it \cite{alwen_coretti_dodis_2020}. Furthermore, because the model is exclusive to the Signal protocol, it cannot be used as a reference notion for \gls{rke} because it provides a lower degree of security than would be expected for \gls{rke} \cite{poettering2018asynchronous}.
\par

\section{Post-Quantum Security of Signal Protocol}
The majority of cryptographic primitives are based on mathematical concepts that can be computed theoretically. However on the practical side, these calculations, are computationally challenging.  Current cryptographic primitives are robust enough that they cannot be broken by an adversary with typically limited processing capacity. Previously, Shor \cite{shor94} and Grover \cite{gro96} proposed quantum algorithms that, in theory, can infringe the cryptographic principles in a wide range of cryptography primitives.
\par
Shor's algorithm is a quantum computer algorithm for determining an integer's prime factors. The algorithm executes in polynomial time, implying that the integer factorization problem can be performed effectively on a quantum computer. As a result, it could be used to break public-key cryptography schemes like RSA, Finite Field Diffie-Hellman key exchange, and Elliptic Curve Diffie-Hellman key exchange.
\par
Grover's algorithm, commonly known as the quantum search algorithm, is an unstructured search strategy that enhances search performance in unsorted data. When compared to standard counterpart techniques, it results in a quadratic speedup. Grover's algorithm, in the context of cryptography, basically tackles the problem of function inversion. The approach might be used in a variety of symmetric-key cryptography brute-force attacks, including collision and pre-image attacks. For example, it could brute-force a 128-bit symmetric cryptographic key in roughly $ 2^{64} $ iterations, or a 256-bit key in roughly $ 2^{128} $ iterations.
\par
The performance of a quantum computer is substantially superior to that of a regular computer. The security of various cryptographic primitives is jeopardized by the emergence of quantum computers. Hence, if a quantum computer with enough qubits is utilized, most asymmetric cryptography methods and protocols will be broken. On the other hand, if sufficiently high key sizes are used, most symmetric encryption techniques are now deemed quantum-safe \cite{essay77239}. The same may be stated for the majority of hash functions as most of them stay quantum secure \cite{ber09}, given that it is required to create hashes of double the size \cite{bra+98}.
\par
Some existing cryptography is quantum-safe, although the majority of post-quantum algorithms are still in development. The \gls{nist} began the first step of standardizing numerous post-quantum algorithms in 2017. This standardization procedure examines 69 post-quantum algorithms \cite{chen2016report}. A subset of 26 algorithms were picked from the original candidate algorithms to proceed to the second phase of the procedure, where another group of algorithms was chosen to advance to the third stage of standardization \cite{alagic2020status}. Because the standardization process is not yet complete, the algorithms may be vulnerable to unforeseen flaws. During the process, the vulnerabilities are detected and the algorithms are refined, resulting in fewer uncovered issues. Nevertheless, the adoption of post-quantum algorithms at the moment is accompanied by some hardships. For instance, the majority of post-quantum algorithms employ keys of a greater size than those currently in use. Increased key size may make storing private keys on constrained devices, such as \gls{iot}, more complex, as well as impose a message overhead when conveying keys. Furthermore, the greater part of post-quantum algorithms require more complex computations. This computational complexity leads to longer computation times and increased energy usage. 
\par
As discussed earlier, the Signal Protocol consists of two fundamental components: the initial X3DH key exchange and the Double Ratchet for message exchange and the key update. The cryptographic primitives used in the protocol are: key exchanges, \glspl{kdf}, signature schemes, and symmetric encryption. The protocol specification employs the specific cryptographic algorithms listed in table \ref{tab:signal-alg}.

\begin{table}[htbp]
	\centering
	\caption{Pre-Quantum Signal Protocol Algorithms}
	\label{tab:signal-alg}
	\arrayrulecolor{black}
	\begin{tabular}{!{\color{black}\vrule}l!{\color{black}\vrule}l!{\color{black}\vrule}} 
		\hline
		\rowcolor[rgb]{ .745,  .804,  .843}	Cryptographic Primitives            & Algorithm used           \\ 
		\hline
		\hline
		Key exchange                        & \acrshort{ecdh}, with Curve25519    \\ 
		\hline
		\gls{kdf}                           & HKDF, with SHA-512       \\ 
		\hline
		X3DH Signature Scheme               & XEdDSA, with Curve25519  \\ 
		\hline
		Double Ratchet Symmetric Encryption & AES-256 in CBC mode      \\
		\hline
	\end{tabular}
\end{table}
Some of the protocol's components utilize algorithms which are considered quantum secure, or can be with a slight modification.  
Firt, the KDF component which is usually based on cryptographic hash functions. It is crucial to use quantum secure hash functions, which is not related to the factorization problem. The Double Ratchet specification recommends implementing HKDF on an HMAC with SHA-256 or SHA-512. A HKDF based upon a SHA-2 as its underlying hash function has a significant impact on Gorver's algorithm search cost \cite{bogomolec2019towards}. So far, such HKDF is considered post-quantum secure.
\par
Next, the AES symmetric encryption algorithm used for message encryption. A quantum computer, with its improved calculating capabilities, can degrade this algorithm. Although not to the level that Shor's algorithm undermines asymmetric systems. The algorithm's quantum cryptographic security can be boosted by increasing the key size.
\par
Furthermore, \gls{ec} algorithms are based on discrete logarithm problems for elliptic curves which are solved within a reasonable amount of time using Shor’s algorithm. Therefore, \gls{ecdh} is directly threatened by quantum computers and its operations are not post-quantum secure within the Signal protocol. Thus, each key exchange algorithm based on \gls{ecdh} as well as the signature scheme based on Curve25519 or Curve448 \glspl{ec}, which were recommended by the protocol specification, must be substituted by alternative post-quantum algorithms. 
\par
Currently, many of the post-quantum key exchange algorithms require interaction from communicating parties during the key exchange, i.e. synchronous algorithms. While such algorithms are not a suitable substitute for use in X3DH, they can be used in a workaround for the double ratchet algorithm.

